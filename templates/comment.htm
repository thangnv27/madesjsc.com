
<script src="{dir_path}/js/jquery.form.min.js"></script>
<script src="{dir_path}/js/jquery.quick.pagination.min.js"></script>
<script src="{dir_path}/js/jRate.js"></script>

<div class="content-tab-scroll" id="comment">

    <h2 class="title-comment">Bình luận (<span id="count_comment" style="color:#d20000">{number_comment}</span>)</h2>
    <div class="c10"></div>
	
    <div class="c10"></div>
    <div  style="background:#EEE; border:solid 10px #EEE">
    	<form action="{dir_path}/index4.php?page=comment" method="post" onSubmit="return check_null_form('commentform');" id="commentform">
        <input type="hidden" name="star_rate" value="0" id="myRating"/>
	    <div style="float:left; margin-right:10px"><strong>Đánh giá</strong></div>

        <div id="jRate" style="height:25px;width: 150px; float:left"></div>
	
        	<script type="text/javascript">
		$(function () {
			var that = this;
			var toolitup = $("#jRate").jRate({
				rating: 1,
				strokeColor: 'black',
				width: 24,
				height: 24,
				precision: 1,
				minSelected: 1,
				onChange: function(rating) {
					console.log("OnChange: Rating: "+rating);
					$('#myRating').val(rating);
				},
				onSet: function(rating) {
					console.log("OnSet: Rating: "+rating);
				}
			});
			
			
			
		});
	</script>
									
        
        <div class="c10"></div>
        <div class="reply_comment_form1" style="position:relative;margin-left:45px;"  id="box_comment_pro">
            <div class="avatar-comment"></div>
            
            	
                <input type="hidden" name="commentpost" value="1" />
                <input type="hidden" name="id_product" value="{id_product}"/>
                <input type="hidden" name="parentid" value="0" />

                <textarea name="inputcomment" id="inputcomment" class="notNull inputcomment" rows="4" style="width:100%; height:50px;"></textarea>
                <div class="c5"></div>
                <div class="col-1-3"><input class="txt-comment showinput inputemail" name="inputemail" type="text" placeholder="Nhập email để theo dõi bình luận"></div>
                <div class="col-1-3"><input class="txt-comment showinput notNull inputname" name="inputname" type="text" placeholder="Bạn cho một cái tên (Bắt buộc)"></div>
                <div class="col-1-3">
                    <input id="captcha" class="txt-comment showinput notNull"  name="captcha" placeholder="Mã bảo mật" type="text" style="float:left; width:35%;  ">
                    <img src="{dir_path}/lib/imagesercurity.php" name="imgCaptcha" class="showinput" align="absmiddle" id="imgCaptcha" style="margin-left:5px; float:left; height: 30px; margin-right: 5px; " />
                    <a href="#" class="showinput thoatCookie " onClick="eraseCookie('member_name');
                                            eraseCookie('member_email'); $('.reply_comment_form1').slideUp();
                                            return false;">Thoát</a>
                    
                    
                </div>
                <div class="c5"></div>
                <div  style="text-align:right">
                    <button class="btn-comment" onClick="$('#commentform').submit();
                            return false;" style="white-space:nowrap">Gửi bình luận</button>
                </div>
                <div class="c"></div>

                <div class="message_error" id="message_success" style="display:none;">Bạn cần nhập đầy đủ thông tin vào nhưng trường có viền màu đỏ !</div>

                <div class="showmessage_respon">

                </div>
                <div id="msg_comment"></div>
                <div class="c"></div>
            
        </div></form>
    </div>
	
    <div class="c10"></div>
    <div class="c10"></div>
    <div id="show_comment_estate" style="position:relative">
		<ul class="pagination" style="list-style: none;">

        <!-- START BLOCK : lstComment -->
		<li>
        <div class="comment-item-list" >
            <div style="position:relative;margin-left:45px; min-height:40px;">
                <div class="avatar-comment"></div>
                <div style="font-weight:bold">{name} {str_star}</div>
                <div style=" padding:0px 0px 10px 0px">
                    <div>{comment}</div>
                    <div class="c5"></div>

                    <div><a href="#c_m{id_comment}" class="like-comment reply_comment" ><i class="fa fa-reply"></i>Trả lời</a> <span> <a href="#" data-like="{id_comment}" data-value="1" onClick="like($(this)); return false" style="margin-left:20px;" class="like-comment"><i class="fa fa-thumbs-up"></i> Thích ({like})</a></span> <span style="margin-left:10px; color:#666; font-weight:normal">{createdate}</span> </div>

                </div>
                <div class="c10"></div>
                <div>
                    <div style="position:relative; ">
                        <!-- START BLOCK : lstSubComment -->
                        <div style="background:#EEE; padding:5px 5px 5px 50px">
                            <div class="avatar-comment1">{avatar}</div>
                            <div class="{isadmin}" style="font-weight:bold; float: left; ">{sub_name}</div>
                            <div class="c"></div>
                            <div style="border-bottom:solid 1px #EEE; padding:0px 0px 10px 0px">
                                <div>{sub_comment}</div>
                                <div class="c5"></div>
                                <div>

                                    <span> <a href="#" data-like="{sub_id_comment}" data-value="1" onClick="like($(this));
                                            return false" style="margin-left:20px;" class="like-comment"><i class="fa fa-thumbs-up"></i> Thích ({sub_like})</a></span> <span style="margin-left:10px; color:#666"> {sub_createdate}</span>


                                </div>
                            </div>
                        </div>
                        <div class="c5"></div>

                        <!-- END BLOCK : lstSubComment -->

                        <div class="reply_comment_form" id="c_m{id_comment}" style="display:none;">
                            <form class="commentform" id="form_m{id_comment}" action="{dir_path}/index4.php?page=comment" method="post" onSubmit="return check_null_form('form_m{id_comment}');" >
                                <input type="hidden" name="commentpost" value="1" />
                                <input type="hidden" name="parentid" value="{id_comment}" />
                                <input type="hidden" name="id_product" value="{id_product}"/>

                                <div class="commentarea">

                                    <textarea name="inputcomment" class="inputcomment notNull" rows="4" style="width:100%; height:50px;"></textarea>
                                    <div class="c5"></div>
                                    <div class="col-1-3"><input class="txt-comment inputemail" name="inputemail" type="text" placeholder="Nhập email để theo dõi bình luận"></div>
                                    <div class="col-1-3"><input class="txt-comment  notNull inputname" name="inputname" type="text" placeholder="Bạn cho một cái tên (Bắt buộc)"></div>
                                    <div class="col-1-3">
                                        <input id="captcha" class="txt-comment  notNull"  name="captcha" placeholder="Mã bảo mật" type="text" style="float:left; width:35%"><img src="{dir_path}/lib/imagesercurity.php" name="imgCaptcha" class="" align="absmiddle" id="imgCaptcha" style="margin-left:5px; float:left; height: 30px;" />
                                        &nbsp;
                                        <a href="#" class="thoatCookie" onClick="eraseCookie('member_name');
                                            eraseCookie('member_email'); $('.reply_comment_form').slideUp();
                                            return false;">Thoát</a>

                                    </div>


                                    <div class="c5"></div>

                                    <div  style="text-align:right">
                                        <button class="btn-comment" onClick="$('#form_m{id_comment}').submit();
                                            return false;" style="white-space:nowrap">Gửi bình luận</button>
                                    </div>
                                    <div class="c"></div>

                                    <div class="message_error" style="display:none;">Bạn cần nhập đầy đủ thông tin vào nhưng trường có viền màu đỏ !</div>

                                </div>

                                <div class="showmessage_respon">

                                </div>
                                <div class="msg_comment"></div>
                                <div class="c"></div>
                            </form>


                        </div>


                    </div>

                </div>

            </div>   
        </div>
        <div class="c10"></div>
        <div style="border-bottom:solid 1px #EEE"></div>
        <div class="c10"></div>
        </li>
        <!-- END BLOCK : lstComment --> 
        </ul>
        <script>
            $(function() {

				$("ul.pagination").quickPagination({ pagerLocation:"bottom", pageSize:"10" });

				$('.simplePagerNav a').click(function(){
					var topcomment = $('#comment').position();
					$("html, body").animate({ scrollTop: (topcomment.top - 100) }, "slow");
					return false;    
				});
		


                $('#count_comment').text('{number_comment}');
                $('.reply_comment').click(function() {
                    $('.reply_comment_form').slideUp();
                    $($(this).attr('href')).slideDown();

                    $('.inputname').val(readCookie('member_name'));
                    $('.inputemail').val(readCookie('member_email'));
                    
                    if (readCookie('member_name'))
                        $('.reply_comment_form .thoatCookie').show();
                    else
                        $('.reply_comment_form .thoatCookie').hide();


                    return false;
                });
            })
        </script>
    </div>

    <style>

    .simplePagerNav{
        float: right;
        
    }
    
    .simplePagerNav a{
        text-decoration: none;
        color: #666;
    }    
    
    .simplePagerNav li {
        float: left;
        list-style: none;
        font-weight: bold;
        border: 1px solid #00904c;
        padding: 1px 6px;
        margin-left: 10px;
	}

	.currentPage {
		background: #00904c;
		color: #FFF;
	}
	
	.currentPage a{
		color: #FFF;
	}
    

        .liked-comment{
            text-decoration: none;
            color: #666;
        }

        .alert-error{
            color: #d20000;
        }

        .isadmin{
            background-color: #FF0;
            padding: 3px 10px;
            border-radius: 3px;
            order: solid 1px #CCC;
            text-transform: uppercase;
        }        
        .thoatCookie{
            text-decoration: none;
            background: #00904c;
            line-height: 30px;
            color: #FFF;
            padding: 8px 10px;
        }
    </style>

    <script>


        function like(obj) {
            var datalike = obj.attr('data-like');
            var datavalue = obj.attr('data-value');
            obj.parent().load('/index4.php?page=comment&code=like&idcomment=' + datalike + '&v=' + datavalue, function(response, status, xhr) {

                if (status == "success") {
                }
                if (status == "error") {

                }
            });
        }

        function check_null_form(objForm) {
            var ok = true;
            $('#' + objForm + ' .notNull').each(function() {
                if ($(this).val() == '') {
                    ok = false;
                    $(this).addClass('border-error');
                    $('.message-success').hide();
                    $('.message-error').show();
                }
            });
            if ($('#' + objForm + ' .inputcomment').val().length < 7) {
                ok = false;
                alert("Nội dung bình luận quá ngắn !");
                $('#' + objForm + ' .inputcomment').focus();
                $('#' + objForm + ' .message-success').hide();
                $('#' + objForm + ' .message-error').show();
            }
            
            if (ok == true) {
                if (objForm == 'commentform')
                    $('.reply_comment_form1').append('<div class="ajaxloading"><i class="fa fa-circle-o-notch fa-spin" ></i></div>');
                else
                    $('.reply_comment_form').append('<div class="ajaxloading"><i class="fa fa-circle-o-notch fa-spin" ></i></div>');
                
                $('#' + objForm).ajaxSubmit({
                    //target:        '#msg_comment',
                    success: function(formData) {

                        $('.ajaxloading').remove();
                        $('#' + objForm + ' .showmessage_respon').html('');
                        $('#' + objForm + ' .showmessage_respon').html(formData).show();
                        $('.imgCaptcha').attr('src', '{dir_path}/lib/imagesercurity.php?x=' + $.now());

                        var str1 = formData;
                        var str2 = "captcha";
                        if (str1.indexOf(str2) == -1) {
                            $('#' + objForm)[0].reset();

                            $('#' + objForm + ' .commentarea').hide();

                        }
                    }

                });
                createCookie('member_name', $('#' + objForm + ' .inputname').val(), 30);
                createCookie('member_email', $('#' + objForm + ' .inputemail').val(), 30);

                return false;
            }
            return false;
        }

    </script>




    <script>



        $(function() {
            $('#inputcomment').on("keypress", function() {
                showinputcomment();
            });
            $('#inputcomment').change(function() {
                showinputcomment();
            });
        });
        function showinputcomment() {
            if ($('#inputcomment').val().length > 6) {
                $('.showinput').show();
                $('.inputname').val(readCookie('member_name'));
                $('.inputemail').val(readCookie('member_email'));
                //alert(readCookie('member_name'));
                if (readCookie('member_name'))
                    $('.thoatCookie').show();
                else
                    $('.thoatCookie').hide();
            }
        }
        function hideinputcomment() {
            $('.showinput').hide();
        }

        /*Cookie*/
        function createCookie(name, value, days) {
            var expires;

            if (days) {
                var date = new Date();
                date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                expires = "; expires=" + date.toGMTString();
            } else {
                expires = "";
            }
            document.cookie = encodeURIComponent(name) + "=" + encodeURIComponent(value) + expires + "; path=/";
        }

        function readCookie(name) {
            var nameEQ = encodeURIComponent(name) + "=";
            var ca = document.cookie.split(';');
            for (var i = 0; i < ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0) === ' ')
                    c = c.substring(1, c.length);
                if (c.indexOf(nameEQ) === 0)
                    return decodeURIComponent(c.substring(nameEQ.length, c.length));
            }
            return null;
        }

        function eraseCookie(name) {
            createCookie(name, "", -1);
        }


    </script>
</div>